---
# if nginx is not running, ansible will start nginx
- name: Make sure nginx is running
  ansible.builtin.systemd:
    state: started
    name: nginx
  tags:
    - init

- name: Register nginx directory
  ansible.builtin.stat:
    path: "{{ nginx_dir }}"
  register: nginx_dir
  tags:
    - init

- name: Check nginx config directory
  block:
    - name: Fail and print message
      ansible.builtin.fail:
        msg: "{{ nginx_dir }} does not exist"
      when: not nginx_dir.stat.exists

    - name: Print success message
      ansible.builtin.debug:
        msg: "{{ nginx_dir }} exists!!"
  tags:
    - init
    - app

- name: Copy nginx.conf to remote server
  ansible.builtin.copy:
    src: "nginx.conf"
    dest: "{{ nginx_dir }}"
    owner: "{{ remote_server_user }}"
    group: "{{ remote_server_group }}"
    mode: 0644
  tags:
    - init

- name: Test nginx configuration
  ansible.builtin.shell: 'nginx -t'
  tags:
    - init

