---
- name: Test Playbook
  hosts: ec2

  vars_files:
    - ./vars/all.yml

  tasks:
    - name: Register JAR file existence status
      ansible.builtin.stat:
        path: "{{ remote_workspace }}/deploy/{{ module_name }}.jar"
      register: file_status

    - name: Check if JAR file exists
      block:
        - name: Check 'file_status'
          ansible.builtin.fail:
            msg: "{{ module_name }}.jar does not exist"
          when: not file_status.stat.exists

        - name: Print success message
          ansible.builtin.debug:
            msg: "{{ module_name }}.jar exists!!"

    - name: Copy JAR file for running application
      ansible.builtin.copy:
        src: "{{ remote_workspace }}/deploy/{{ module_name }}.jar"
        remote_src: yes
        dest: "{{ remote_workspace }}/app/{{ module_name }}.jar"
        owner: "{{ remote_user }}"
        group: "{{ remote_group }}"

    - name: Remove deployed JAR file
      ansible.builtin.file:
        state: absent
        path: "{{ remote_workspace }}/deploy/{{ module_name }}.jar"

    - name: Finish
      ansible.builtin.debug:
        msg: "All tasks completed!!"